
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../introduction-self-guided/">
      
      
        <link rel="next" href="../lab-2-code_interpreter/">
      
      
      <link rel="icon" href="../media/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.5">
    
    
      
        <title>Lab 1 Function Calling Power - Build your first Agent</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/custom.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#introduction" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Build your first Agent" class="md-header__button md-logo" aria-label="Build your first Agent" data-md-component="logo">
      
  <img src="../media/favicon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Build your first Agent
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lab 1 Function Calling Power
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="pink"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 2c-1.82 0-3.53.5-5 1.35C8 5.08 10 8.3 10 12s-2 6.92-5 8.65C6.47 21.5 8.18 22 10 22a10 10 0 0 0 10-10A10 10 0 0 0 10 2"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="amber" data-md-color-accent="cyan"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Build your first Agent" class="md-nav__button md-logo" aria-label="Build your first Agent" data-md-component="logo">
      
  <img src="../media/favicon.png" alt="logo">

    </a>
    Build your first Agent
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Solution Architecture
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security Considerations
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Workshop Setup
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Workshop Setup
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction-ai-tour/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AI Tour Attendees
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction-self-guided/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Self-Guided Learners
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Lab 1 Function Calling Power
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Lab 1 Function Calling Power
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-exercise" class="md-nav__link">
    <span class="md-ellipsis">
      Lab Exercise
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optional-debug-the-app" class="md-nav__link">
    <span class="md-ellipsis">
      (optional) Debug the App
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stop-the-agent-app" class="md-nav__link">
    <span class="md-ellipsis">
      Stop the Agent App
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab-2-code_interpreter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab 2 Intro to the Code Interpreter
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab-3-file_search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab 3 Grounding with Documents
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab-4-bing_search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab 4 Grounding with Bing Search
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab-5-instrumentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab 5 Instrumentation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../wrapup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wrapping Up
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../summary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Summary
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../resources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resources
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-exercise" class="md-nav__link">
    <span class="md-ellipsis">
      Lab Exercise
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optional-debug-the-app" class="md-nav__link">
    <span class="md-ellipsis">
      (optional) Debug the App
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stop-the-agent-app" class="md-nav__link">
    <span class="md-ellipsis">
      Stop the Agent App
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Lab 1 Function Calling Power</h1>

<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<h3 id="what-is-function-calling">What is Function Calling<a class="headerlink" href="#what-is-function-calling" title="Permanent link">&para;</a></h3>
<p>Function calling enables Large Language Models (LLMs) to interact with external systems, execute tasks, and integrate with APIs. The LLM determines when to invoke a function based on user prompts and returns structured data for app use. Developers then implement the function logic within the app.</p>
<p>In this workshop, the function logic is used to execute the LLM dynamically generated SQL queries against the SQLite database.</p>
<h3 id="enabling-function-calling">Enabling Function Calling<a class="headerlink" href="#enabling-function-calling" title="Permanent link">&para;</a></h3>
<p>If you’re familiar with <a href="https://learn.microsoft.com/azure/ai-services/openai/how-to/function-calling" target="_blank">Azure OpenAI Function Calling</a>, it requires defining a function schema for the LLM. Azure AI Agent Service supports this approach and also offers a more flexible option.</p>
<p>With the Azure AI Agent Service and its Python SDK, you can define the function schema directly within the Python function’s docstring. This approach keeps the definition and implementation together, simplifying maintenance and enhancing readability.</p>
<p>For example, in the <strong>sales_data.py</strong> file, the <strong>async_fetch_sales_data_using_sqlite_query</strong> function uses a docstring to specify its signature, inputs, and outputs. The SDK parses this docstring to generate the callable function for the LLM:</p>
<div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">async_fetch_sales_data_using_sqlite_query</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;SalesData&quot;</span><span class="p">,</span> <span class="n">sqlite_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function is used to answer user questions about Contoso sales data by executing SQLite queries against the database.</span>

<span class="sd">    :param sqlite_query: The input should be a well-formed SQLite query to extract information based on the user&#39;s question. The query result will be returned as a JSON object.</span>
<span class="sd">    :return: Return data in JSON serializable format.</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
<h3 id="dynamic-sql-generation">Dynamic SQL Generation<a class="headerlink" href="#dynamic-sql-generation" title="Permanent link">&para;</a></h3>
<p>When the app starts, it incorporates the database schema and key data into the instructions for the Azure AI Agent Service. Using this input, the LLM generates SQLite-compatible SQL queries to respond to user requests expressed in natural language.</p>
<h2 id="lab-exercise">Lab Exercise<a class="headerlink" href="#lab-exercise" title="Permanent link">&para;</a></h2>
<p>In this lab, you'll enable the function logic to execute dynamic SQL queries against the SQLite database. The function will be called by the LLM to answer user questions about Contoso sales data.</p>
<ol>
<li>
<p>Open the <code>main.py</code>.</p>
</li>
<li>
<p><strong>Uncomment</strong> the following lines by removing the <strong>"# "</strong> characters</p>
<div class="highlight"><pre><span></span><code><span class="c1"># INSTRUCTIONS_FILE = &quot;instructions/instructions_function_calling.txt&quot;</span>

<span class="c1"># toolset.add(functions)</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The lines to be uncommented are not adjacent. When removing the # character, ensure you also delete the space that follows it.</p>
</div>
</li>
<li>
<p>Review the Code in main.py.</p>
<p>After uncommenting, your code should look like this:</p>
<div class="highlight"><pre><span></span><code><span class="n">INSTRUCTIONS_FILE</span> <span class="o">=</span> <span class="s2">&quot;instructions/instructions_function_calling.txt&quot;</span>
<span class="c1"># INSTRUCTIONS_FILE = &quot;instructions/instructions_code_interpreter.txt&quot;</span>
<span class="c1"># INSTRUCTIONS_FILE = &quot;instructions/instructions_file_search.txt&quot;</span>
<span class="c1"># INSTRUCTIONS_FILE = &quot;instructions/instructions_bing_grounding.txt&quot;</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">add_agent_tools</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add tools for the agent.&quot;&quot;&quot;</span>

    <span class="c1"># Add the functions tool</span>
    <span class="n">toolset</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">functions</span><span class="p">)</span>

    <span class="c1"># Add the code interpreter tool</span>
    <span class="c1"># code_interpreter = CodeInterpreterTool()</span>
    <span class="c1"># toolset.add(code_interpreter)</span>

    <span class="c1"># Add the tents data sheet to a new vector data store</span>
    <span class="c1"># vector_store = await utilities.create_vector_store(</span>
    <span class="c1">#     project_client,</span>
    <span class="c1">#     files=[TENTS_DATA_SHEET_FILE],</span>
    <span class="c1">#     vector_name_name=&quot;Contoso Product Information Vector Store&quot;,</span>
    <span class="c1"># )</span>
    <span class="c1"># file_search_tool = FileSearchTool(vector_store_ids=[vector_store.id])</span>
    <span class="c1"># toolset.add(file_search_tool)</span>

    <span class="c1"># Add the Bing grounding tool</span>
    <span class="c1"># bing_connection = await project_client.connections.get(connection_name=BING_CONNECTION_NAME)</span>
    <span class="c1"># bing_grounding = BingGroundingTool(connection_id=bing_connection.id)</span>
    <span class="c1"># toolset.add(bing_grounding)</span>
</code></pre></div>
</li>
</ol>
<h3 id="review-the-instructions">Review the Instructions<a class="headerlink" href="#review-the-instructions" title="Permanent link">&para;</a></h3>
<p>Open the <strong>src/workshop/instructions/instructions_function_calling.txt</strong> file and review the <strong>Tools</strong> section for details on the function-calling instructions.</p>
<div class="admonition tip">
<p class="admonition-title">In VS Code, press Alt + Z (Windows/Linux) or Option + Z (Mac) to enable word wrap mode, making the instructions easier to read.</p>
</div>
<p>The Instructions file <code>instructions_function_calling.txt</code> is interpreted by the <code>gpt-4o</code> model to define the behavior of our agent. So far, it:</p>
<ul>
<li><strong>Defines the role</strong> of our agent: "Your role is to assist Contoso users with sales data inquiries with a polite."</li>
<li><strong>Provides contextual information</strong> of use to the agent: "Contoso is a online outdoors camping and sports gear retailer."</li>
<li><strong>Defines the "Sales data assistance" tool</strong> that the agent will use to respond to user queries. In detail, it:<ul>
<li>defines a function the agent can use to form a SQL query and run it on a database</li>
<li>provides information about the database schema to help the agent form its query</li>
<li>asks for aggregated data and at most 30 rows of data</li>
<li>formats the output as Markdown tables</li>
</ul>
</li>
<li><strong>Provides general guidance</strong> for queries, including to make responses "actionable and relevent"</li>
<li><strong>Suggests tips</strong> to provide to user when they ask for help</li>
<li><strong>Sets safety and conduct procedures</strong>, for when users ask questions that are unclear, out of scope, or malicious.</li>
</ul>
<p>We will enhance these instructions during the lab to add additional tools that expand the capabilities of the agent.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The {database_schema_string} placeholder in the instructions is replaced with the actual database schema when the app initializes.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Replace the placeholder with the database schema string</span>
<span class="n">instructions</span> <span class="o">=</span> <span class="n">instructions</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{database_schema_string}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">database_schema_string</span><span class="p">)</span>
</code></pre></div>
</div>
<!-- ### Review the Function Logic

Examine the **async_fetch_sales_data_using_sqlite_query** function in the **sales_data.py** file.

!!! note annotate "The SDK parses the function’s docstring to generate the function definition passed to the LLM. This function is invoked by the LLM to execute dynamic SQL queries."

```python
async def async_fetch_sales_data_using_sqlite_query(self: "SalesData", sqlite_query: str) -> str:
        """
        This function is used to answer user questions about Contoso sales data by executing SQLite queries against the database.

        :param sqlite_query: The input should be a well-formed SQLite query to extract information based on the user's question. The query result will be returned as a JSON object.
        :return: Return data in JSON serializable format.
        :rtype: str
        """
``` -->

<h3 id="run-the-agent-app">Run the Agent App<a class="headerlink" href="#run-the-agent-app" title="Permanent link">&para;</a></h3>
<ol>
<li>Press <kbd>F5</kbd> to run the app.</li>
<li>
<p>In the terminal, you'll see the app start, and the agent app will prompt you to enter your query.</p>
<p><a class="glightbox" href="../media/run-the-agent.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Agent App" src="../media/run-the-agent.png" width="600" /></a></p>
</li>
</ol>
<h3 id="start-a-conversation-with-the-agent">Start a Conversation with the Agent<a class="headerlink" href="#start-a-conversation-with-the-agent" title="Permanent link">&para;</a></h3>
<p>Start asking questions about Contoso sales data. For example:</p>
<ol>
<li>
<p><strong>Help</strong></p>
<p>Here is an example of the LLM response to the <strong>help</strong> query:</p>
<p><em>I’m here to help with your sales data inquiries at Contoso. Could you please provide more details about what you need assistance with? Here are some example queries you might consider:</em></p>
<ul>
<li><em>What were the sales by region?</em></li>
<li><em>What was last quarter's revenue?</em></li>
<li><em>Which products sell best in Europe?</em></li>
<li><em>Total shipping costs by region?</em></li>
</ul>
<p><em>Feel free to ask any specific questions related to Contoso sales data!</em></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The LLM will provide a list of starter questions that were defined in the instructions file.
Try asking help in your language, for example <code>help in Hindi</code> or <code>help in Italian</code>.</p>
</div>
</li>
<li>
<p><strong>Show the 3 most recent transaction details</strong></p>
<p>In the response you can see the raw data stored in the SQLite database. Each record is a single
sales transaction for Contoso, with information about the product, product category, sale amount and region, date, and much more. </p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The agent may refuse to respond to this query with a message like "I'm unable to provide individual transaction details". This is because the instructions direct it to "provide aggregated results by default". If this happens, try again, or reword your query.</p>
<p>Large Language models have random behavior, and may give different responses even if you repeat the same query.</p>
</div>
</li>
<li>
<p><strong>What are the sales by region?</strong></p>
<p>Here is an example of the LLM response to the <strong>sales by region</strong> query:</p>
<pre><code>| Region         | Total Revenue  |
|----------------|----------------|
| AFRICA         | $5,227,467     |
| ASIA-PACIFIC   | $5,363,718     |
| CHINA          | $10,540,412    |
| EUROPE         | $9,990,708     |
| LATIN AMERICA  | $5,386,552     |
| MIDDLE EAST    | $5,312,519     |
| NORTH AMERICA  | $15,986,462    |
</code></pre>
<p>So, what’s happening behind the scenes to make it all work?</p>
<p>The LLM orchestrates the following steps:</p>
<ol>
<li>
<p>The LLM generates an SQL query to answer the user's question. For the question <strong>"What are the sales by region?"</strong>, the following SQL query is generated:</p>
<p><code>SELECT region, SUM(revenue) AS total_revenue FROM sales_data GROUP BY region;</code></p>
</li>
<li>
<p>The LLM then asks the agent app to call the <strong>async_fetch_sales_data_using_sqlite_query</strong> function, which retrieves the required data from the SQLite database and returns it to the LLM.</p>
</li>
<li>Using the retrieved data, the LLM generates a table in Markdown format and returns it to the user. If you check the instructions file, you'll notice that the default output format is Markdown.</li>
</ol>
</li>
<li>
<p><strong>Show sales by category in Europe</strong></p>
<p>In this case, an even more complex SQL query is being run by the agent.</p>
</li>
<li>
<p><strong>Breakout sales by footwear</strong></p>
<p>Note how much interpetation the agent does here: determining what product types fit should be included in "footwear", and understanding the unclear term "breakout".</p>
</li>
<li>
<p><strong>Show sales by region as a pie chart</strong></p>
<p>Our agent can't create charts ... yet. We'll fix that in the next lab.</p>
</li>
</ol>
<h2 id="optional-debug-the-app">(optional) Debug the App<a class="headerlink" href="#optional-debug-the-app" title="Permanent link">&para;</a></h2>
<p>Set a <a href="https://code.visualstudio.com/Docs/editor/debugging" target="_blank">breakpoint</a> in the <code>async_fetch_sales_data_using_sqlite_query</code> function located in <code>sales_data.py</code> to observe how the LLM requests data.</p>
<div class="admonition info">
<p class="admonition-title">Note: To use the debug feature, exit the previous run. Then set the breakpoint. Then run the application using the debugger icon in the sidebar. This will open up the debug sidebar, allowing you to watch stack traces and step through execution.</p>
</div>
<p><a class="glightbox" href="../media/breakpoint.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Breakpoint" src="../media/breakpoint.png" width="600" /></a></p>
<h3 id="ask-more-questions">Ask More Questions<a class="headerlink" href="#ask-more-questions" title="Permanent link">&para;</a></h3>
<p>Now that you’ve set a breakpoint, ask additional questions about Contoso sales data to observe the function logic in action. Step through the function to execute the database query and return the results to the LLM.</p>
<p>Try these questions:</p>
<ol>
<li><strong>What regions have the highest sales?</strong></li>
<li><strong>What were the sales of tents in the United States in April 2022?</strong></li>
</ol>
<h3 id="disable-the-breakpoint">Disable the Breakpoint<a class="headerlink" href="#disable-the-breakpoint" title="Permanent link">&para;</a></h3>
<p>Remember to disable the breakpoint before running the app again.</p>
<h2 id="stop-the-agent-app">Stop the Agent App<a class="headerlink" href="#stop-the-agent-app" title="Permanent link">&para;</a></h2>
<p>When you're done, type <strong>exit</strong>, or press <kbd>Shift</kbd>+<kbd>F5</kbd> to stop the agent app.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../introduction-self-guided/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Self-Guided Learners">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Self-Guided Learners
              </div>
            </div>
          </a>
        
        
          
          <a href="../lab-2-code_interpreter/" class="md-footer__link md-footer__link--next" aria-label="Next: Lab 2 Intro to the Code Interpreter">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Lab 2 Intro to the Code Interpreter
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.footer", "content.code.copy"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
        <script src="../js/custom-nav.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>